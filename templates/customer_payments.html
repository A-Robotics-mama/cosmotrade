<!-- /templates/customer_payments.html -->
 
{% extends "base.html" %}
{% load static %}

{% block title %}Customer Payments{% endblock %}

{% block content %}
<div class="container mt-4">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2>Customer Payments</h2>
    <div>
      <a href="{% url 'customers:customer_new' %}" class="btn btn-success me-2">New Customer</a>
      <a href="{% url 'customers:customer_edit' %}" class="btn btn-warning me-2">Edit Customer</a>
      <a href="{% url 'customers:customer_list' %}" class="btn btn-info me-2">View Customers</a>
      <a href="{% url 'customers:customer_summary_select' %}" class="btn btn-info me-2">Customer Summary</a>
      <a href="{% url 'customers:payments' %}" class="btn btn-info me-2">Payments</a>
      <a href="{% url 'base:dashboard' %}" class="btn btn-secondary">Return to Dashboard</a>
    </div>
  </div>

  <!-- Форма добавления платежа -->
  <h3 class="mt-4">Add New Payment</h3>
  <form method="post" class="card p-4 shadow-sm mb-4">
    {% csrf_token %}
    <div class="mb-3">
      <label for="customer_id" class="form-label">Customer:</label>
      <select name="customer_id" id="customer_id" class="form-select" required>
        <option value="">-- Select a Customer --</option>
        {% for customer in customers %}
          <option value="{{ customer.customer_id }}">{{ customer.fullname }}</option>
        {% endfor %}
      </select>
    </div>
    <div class="mb-3">
      <label for="quotation_number" class="form-label">Quotation Number:</label>
      <input type="text" name="quotation_number" id="quotation_number" class="form-control" placeholder="Enter quotation number">
    </div>
    <div class="mb-3">
      <label for="amount_paid" class="form-label">Amount Paid:</label>
      <input type="number" name="amount_paid" id="amount_paid" class="form-control" step="0.01" required>
    </div>
    <div class="mb-3">
      <label for="payment_date" class="form-label">Payment Date:</label>
      <input type="datetime-local" name="payment_date" id="payment_date" class="form-control" required>
    </div>
    <div class="mb-3">
      <label for="payment_code" class="form-label">Payment Code:</label>
      <select name="payment_code" id="payment_code" class="form-select" required>
        <option value="">-- Select Payment Code --</option>
        {% for code in payment_codes %}
          <option value="{{ code.code }}">{{ code.code }} - {{ code.description }}</option>
        {% endfor %}
      </select>
    </div>
    <div class="mb-3">
      <label for="payment_details" class="form-label">Payment Details:</label>
      <textarea name="payment_details" id="payment_details" class="form-control"></textarea>
    </div>
    <div class="mb-3">
      <label for="transaction_type" class="form-label">Transaction Type:</label>
      <select name="transaction_type" id="transaction_type" class="form-select">
        <option value="">-- Select Transaction Type --</option>
        <option value="CASH_SALE">Cash Sale</option>
        <option value="LEASING">Leasing</option>
        <option value="RENT">Rent</option>
        <option value="RETURN">Return</option>
      </select>
    </div>
    <div class="mb-3">
      <label for="transaction_id" class="form-label">Transaction ID:</label>
      <input type="text" name="transaction_id" id="transaction_id" class="form-control" placeholder="Enter transaction ID">
    </div>
    <div class="mb-3">
      <label for="vat_amount" class="form-label">VAT Amount:</label>
      <input type="number" name="vat_amount" id="vat_amount" class="form-control" step="0.01" value="0">
    </div>
    <div class="mb-3">
      <label for="installment_number" class="form-label">Installment Number:</label>
      <input type="number" name="installment_number" id="installment_number" class="form-control" placeholder="Enter installment number">
    </div>
    <div class="mb-3">
      <label for="product_type" class="form-label">Product Type:</label>
      <select name="product_type" id="product_type" class="form-select">
        <option value="">-- Select Product Type --</option>
        <option value="DEVICE">Device</option>
        <option value="COSMETICS">Cosmetics</option>
        <option value="SUPPLEMENTS">Supplements</option>
        <option value="FURNITURE">Furniture</option>
      </select>
    </div>
    <button type="submit" class="btn btn-primary">Add Payment</button>
  </form>

  <!-- Таблица платежей -->
  <h3 class="mt-4">Payment History</h3>
  <div class="table-responsive">
    <table class="table table-bordered table-striped">
      <thead class="table-light">
        <tr>
          <th>Payment ID</th>
          <th>Customer</th>
          <th>Quotation Number</th>
          <th>Amount Paid</th>
          <th>Payment Date</th>
          <th>Payment Code</th>
          <th>Payment Details</th>
          <th>Transaction Type</th>
          <th>Transaction ID</th>
          <th>VAT Amount</th>
          <th>Installment Number</th>
          <th>Product Type</th>
        </tr>
      </thead>
      <tbody>
        {% for payment in payments %}
          <tr>
            <td>{{ payment.payment_id }}</td>
            <td>{{ payment.customer.fullname }}</td>
            <td>{{ payment.quotation_number|default:"N/A" }}</td>
            <td>€{{ payment.amount_paid|floatformat:2 }}</td>
            <td>{{ payment.payment_date }}</td>
            <td>{{ payment.payment_code }}</td>
            <td>{{ payment.payment_details|default:"N/A" }}</td>
            <td>{{ payment.transaction_type|default:"N/A" }}</td>
            <td>{{ payment.transaction_id|default:"N/A" }}</td>
            <td>€{{ payment.vat_amount|floatformat:2 }}</td>
            <td>{{ payment.installment_number|default:"N/A" }}</td>
            <td>{{ payment.product_type|default:"N/A" }}</td>
          </tr>
        {% empty %}
          <tr>
            <td colspan="12">No payments found.</td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}